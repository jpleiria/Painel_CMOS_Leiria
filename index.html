<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Painel CMOS Leiria</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- RESET & BASICS --- */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Outfit', sans-serif;
            color: #ffffff;
            height: 100vh; height: 100dvh; width: 100vw;
            overflow: hidden;
            background-color: #1a202c;
            cursor: default;
            user-select: none;
            transition: all 0.5s ease;
        }

        /* --- BACKGROUND --- */
        .background-wrapper {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; overflow: hidden;
        }

        .bg-image {
            width: 100%; height: 100%;
            object-fit: cover; object-position: center 60%;
            filter: brightness(0.45) saturate(0.6) contrast(1.1);
            animation: subtlePan 60s infinite alternate ease-in-out;
            transform: scale(1.1);
        }

        .vignette {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.9) 100%);
            pointer-events: none;
        }

        /* --- HUD ALERTA (Borda Vermelha) --- */
        body.shift-alert-active {
            box-shadow: inset 0 0 0 15px #dc2626, inset 0 0 50px rgba(220, 38, 38, 0.5);
            animation: borderFlash 1s infinite alternate;
        }

        /* --- LAYOUT --- */
        main {
            height: 100%; width: 100%;
            display: flex; flex-direction: column;
            align-items: center; /* Garante centralização horizontal total */
            padding: 4vh 3vw;
        }

        /* --- RELÓGIO --- */
        .clock-section {
            text-align: center; width: 100%;
            text-shadow: 0 4px 15px rgba(0,0,0,0.8);
            transition: transform 0.3s ease;
            z-index: 10;
        }
        
        body.shift-alert-active .clock-section { transform: translateY(-10px); } /* Sobe um pouco no alerta */

        .time-wrapper {
            font-size: 14vh; font-weight: 800; line-height: 0.9;
            letter-spacing: -0.03em; display: flex; justify-content: center; align-items: baseline;
            cursor: pointer;
        }
        
        .colon { animation: pulse 2s infinite ease-in-out; margin: 0 0.5rem; position: relative; top: -1vh; }
        .seconds { font-size: 4vh; font-weight: 400; opacity: 0.8; margin-left: 1vh; }
        .date-display {
            font-size: 2.5vh; font-weight: 400; text-transform: uppercase; letter-spacing: 0.3em;
            margin-top: 1vh; opacity: 0.9;
        }

        /* --- ÁREA CENTRAL DE ALERTA --- */
        .shift-anim-container {
            flex-grow: 1;
            width: 100%;
            display: flex;
            flex-direction: column; /* Organiza: Texto em cima, Cartões em baixo */
            justify-content: center;
            align-items: center;
            gap: 30px;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        body.shift-alert-active .shift-anim-container { opacity: 1; }

        /* Título do Alerta */
        .shift-title {
            font-size: 2.5rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: #ef4444;
            text-shadow: 0 0 20px rgba(220, 38, 38, 0.8);
            background: rgba(0,0,0,0.4);
            padding: 10px 40px;
            border-radius: 50px;
            border: 1px solid rgba(239, 68, 68, 0.3);
            transform: scale(0.9);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        body.shift-alert-active .shift-title {
            transform: scale(1);
            animation: textPulse 1.5s infinite alternate;
        }

        /* Linha dos Cartões */
        .cards-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 50px; /* Espaço entre os cartões */
            perspective: 1000px;
        }

        .team-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 25px 40px;
            border-radius: 15px;
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            min-width: 220px;
            transform: scale(0.9);
            transition: transform 0.5s ease, opacity 0.5s ease;
        }

        .team-label { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px; opacity: 0.9; font-weight: 600; }
        .team-icon { font-size: 3rem; }

        /* Estados Iniciais */
        .outgoing { opacity: 0; transform: translateX(30px); }
        .incoming { opacity: 0; transform: translateX(-30px); }
        .sync-icon { font-size: 2.5rem; opacity: 0; color: #fbbf24; }

        /* Estados Ativos */
        body.shift-alert-active .outgoing {
            opacity: 1;
            animation: driftLeft 3s ease-in-out infinite alternate;
        }
        
        body.shift-alert-active .incoming {
            opacity: 1;
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
            animation: pulseCard 2s ease-in-out infinite alternate;
        }

        body.shift-alert-active .sync-icon {
            opacity: 0.8;
            animation: spinSlow 3s infinite linear;
        }

        /* --- METEOROLOGIA --- */
        .weather-section {
            margin-bottom: 1vh; display: flex; justify-content: center; width: 100%;
        }
        .glass-card {
            background: rgba(15, 15, 25, 0.65); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 20px;
            padding: 25px 35px; display: flex; align-items: center; gap: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
            width: 100%; max-width: 1100px;
        }
        .weather-current-col {
            display: flex; align-items: center; gap: 20px; padding-right: 30px;
            border-right: 1px solid rgba(255,255,255,0.15); min-width: 200px; justify-content: center;
        }
        .main-icon-wrapper i { font-size: 4rem; filter: drop-shadow(0 0 15px rgba(255,255,255,0.3)); animation: floatIcon 4s ease-in-out infinite; }
        .temp-block { text-align: left; }
        .temp-big { font-size: 3.5rem; font-weight: 700; line-height: 1; }
        .city-name { font-size: 0.75rem; letter-spacing: 1px; text-transform: uppercase; opacity: 0.6; margin-bottom: 4px;}
        .condition { font-size: 1rem; font-weight: 300; opacity: 0.9;}
        
        .weather-forecast-col {
            flex-grow: 1; display: flex; flex-direction: column; gap: 20px; overflow: hidden; text-align: center;
        }
        .forecast-section-title {
            font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.5; margin-bottom: 10px; font-weight: 600; width: 100%;
        }
        .scroll-container {
            display: flex; justify-content: space-between; gap: 10px; overflow-x: auto; padding-bottom: 5px;
            scrollbar-width: none; -ms-overflow-style: none;
            mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
        }
        .scroll-container::-webkit-scrollbar { display: none; }
        .forecast-unit { display: flex; flex-direction: column; align-items: center; flex: 1; min-width: 60px; }
        .f-time { font-size: 0.8rem; opacity: 0.7; margin-bottom: 5px; }
        .f-icon { font-size: 1.3rem; margin-bottom: 5px; opacity: 0.9; }
        .f-temp { font-weight: 600; font-size: 1rem; }
        .f-temp.min-temp { font-size: 0.8rem; opacity: 0.6; font-weight: 400; }

        /* --- KEYFRAMES --- */
        @keyframes subtlePan { 0% { transform: scale(1.1) translateY(0); } 100% { transform: scale(1.15) translateY(-2%); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes floatIcon { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes borderFlash {
            from { box-shadow: inset 0 0 0 10px #b91c1c, inset 0 0 20px rgba(185, 28, 28, 0.5); }
            to { box-shadow: inset 0 0 0 25px #ef4444, inset 0 0 80px rgba(239, 68, 68, 0.8); }
        }
        @keyframes spinSlow { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Animações dos Cartões */
        @keyframes driftLeft {
            0% { transform: translateX(0) scale(0.9); opacity: 0.8; }
            100% { transform: translateX(-15px) scale(0.85); opacity: 0.5; }
        }
        @keyframes pulseCard {
            0% { transform: translateX(0) scale(1); }
            100% { transform: translateX(0) scale(1.05); }
        }
        @keyframes textPulse {
            0% { text-shadow: 0 0 20px rgba(220, 38, 38, 0.5); transform: scale(1); }
            100% { text-shadow: 0 0 40px rgba(220, 38, 38, 1); transform: scale(1.05); }
        }

        @media (max-width: 900px) {
            .glass-card { flex-direction: column; padding: 20px; gap: 20px; }
            .weather-current-col { border-right: none; border-bottom: 1px solid rgba(255,255,255,0.15); padding-right: 0; padding-bottom: 20px; width: 100%; }
            .scroll-container { justify-content: flex-start; gap: 20px; }
            .team-card { min-width: 140px; padding: 15px; } 
            .team-label { font-size: 0.7rem; }
            .shift-title { font-size: 1.5rem; padding: 10px 20px; }
            .cards-row { gap: 20px; }
        }
    </style>
</head>
<body>

    <div class="background-wrapper">
        <img src="castle.jpg" alt="Castelo de Leiria" class="bg-image">
        <div class="vignette"></div>
    </div>

    <main>
        <div class="clock-section">
            <div class="time-wrapper" ondblclick="triggerShiftAlert()" title="Duplo clique para testar (1 min)">
                <span id="h">--</span><span class="colon">:</span><span id="m">--</span><span class="seconds" id="s">--</span>
            </div>
            <div id="date-full" class="date-display">A carregar...</div>
        </div>

        <div class="shift-anim-container">
            <div class="shift-title">
                <i class="fa-solid fa-triangle-exclamation" style="margin-right:10px"></i>
                Mudança de Turno
                <i class="fa-solid fa-triangle-exclamation" style="margin-left:10px"></i>
            </div>

            <div class="cards-row">
                <div class="team-card outgoing">
                    <i class="fa-solid fa-users-slash team-icon"></i>
                    <div class="team-label">Piquete de Saída</div>
                    <i class="fa-solid fa-arrow-left-long" style="margin-top:5px; opacity: 0.7;"></i>
                </div>
                
                <i class="fa-solid fa-arrows-rotate sync-icon"></i>
                
                <div class="team-card incoming">
                    <i class="fa-solid fa-users team-icon"></i>
                    <div class="team-label">Piquete de Entrada</div>
                    <i class="fa-solid fa-check" style="margin-top:5px"></i>
                </div>
            </div>
        </div>

        <div class="weather-section">
            <div class="glass-card">
                <div class="weather-current-col">
                    <div class="main-icon-wrapper" id="main-icon">
                        <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem; opacity: 0.5;"></i>
                    </div>
                    <div class="temp-block">
                        <div class="city-name"><i class="fa-solid fa-location-dot"></i> Leiria, PT</div>
                        <div class="temp-big"><span id="temp-val">--</span>°</div>
                        <div class="condition" id="cond-text">A iniciar...</div>
                    </div>
                </div>
                <div class="weather-forecast-col">
                    <div>
                        <div class="forecast-section-title">Previsão Horária</div>
                        <div class="scroll-container" id="hourly-row"></div>
                    </div>
                    <div>
                        <div class="forecast-section-title">Próximos Dias</div>
                        <div class="scroll-container" id="daily-row"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- LÓGICA DO ALERTA E ANIMAÇÃO ---
        let alertTimeout = null;
        let isAlertActive = false;

        function triggerShiftAlert() {
            if (isAlertActive) return; 
            
            isAlertActive = true;
            document.body.classList.add('shift-alert-active');
            
            // Remove automaticamente após 1 minuto (60000ms)
            if(alertTimeout) clearTimeout(alertTimeout);
            alertTimeout = setTimeout(() => {
                document.body.classList.remove('shift-alert-active');
                isAlertActive = false;
            }, 60000);
        }

        // --- RELÓGIO ---
        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');

            document.getElementById('h').textContent = h;
            document.getElementById('m').textContent = m;
            document.getElementById('s').textContent = s;

            // Trigger Automático: 08:00:00 e 20:00:00
            if (m === '00' && s === '00') {
                if (h === '08' || h === '20') {
                    triggerShiftAlert();
                }
            }

            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            let dateStr = now.toLocaleDateString('pt-PT', options);
            dateStr = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);
            document.getElementById('date-full').textContent = dateStr;
        }
        
        setInterval(updateClock, 1000);
        updateClock();

        // --- METEOROLOGIA ---
        const API_URL = "https://api.open-meteo.com/v1/forecast?latitude=39.74&longitude=-8.81&current=temperature_2m,weather_code,is_day&hourly=temperature_2m,weather_code,is_day&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=7";

        const weatherMap = {
            0: { icon: 'fa-sun', text: 'Limpo' }, 1: { icon: 'fa-cloud-sun', text: 'Pouco nublado' },
            2: { icon: 'fa-cloud-sun', text: 'Parcial nublado' }, 3: { icon: 'fa-cloud', text: 'Nublado' },
            45: { icon: 'fa-smog', text: 'Nevoeiro' }, 48: { icon: 'fa-smog', text: 'Nevoeiro' },
            51: { icon: 'fa-cloud-rain', text: 'Chuvisco' }, 53: { icon: 'fa-cloud-rain', text: 'Chuvisco' },
            61: { icon: 'fa-umbrella', text: 'Chuva' }, 63: { icon: 'fa-umbrella', text: 'Chuva' },
            80: { icon: 'fa-cloud-showers-heavy', text: 'Aguaceiros' }, 95: { icon: 'fa-bolt', text: 'Trovoada' }
        };

        function getWeatherInfo(code, isDay = 1) {
            let info = weatherMap[code] || { icon: 'fa-cloud', text: 'Nublado' };
            if (isDay === 0) {
                if (info.icon === 'fa-sun') info.icon = 'fa-moon';
                if (info.icon === 'fa-cloud-sun') info.icon = 'fa-cloud-moon';
            }
            return info;
        }

        async function updateWeather() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                const curr = data.current;
                const info = getWeatherInfo(curr.weather_code, curr.is_day);

                document.getElementById('temp-val').textContent = Math.round(curr.temperature_2m);
                document.getElementById('cond-text').textContent = info.text;
                document.getElementById('main-icon').innerHTML = `<i class="fa-solid ${info.icon}"></i>`;

                const hCont = document.getElementById('hourly-row');
                hCont.innerHTML = '';
                const currentHour = new Date().getHours();
                for (let i = 1; i <= 5; i++) {
                    const idx = currentHour + i;
                    if(!data.hourly.time[idx]) continue;
                    const dateObj = new Date(data.hourly.time[idx]);
                    const hourLabel = String(dateObj.getHours()).padStart(2, '0') + ":00";
                    const temp = Math.round(data.hourly.temperature_2m[idx]);
                    const wInfo = getWeatherInfo(data.hourly.weather_code[idx], data.hourly.is_day[idx]);

                    hCont.innerHTML += `
                        <div class="forecast-unit">
                            <span class="f-time">${hourLabel}</span>
                            <i class="fa-solid ${wInfo.icon} f-icon"></i>
                            <span class="f-temp">${temp}°</span>
                        </div>`;
                }

                const dCont = document.getElementById('daily-row');
                dCont.innerHTML = '';
                for (let i = 1; i <= 5; i++) {
                    const d = new Date(data.daily.time[i]);
                    let dName = d.toLocaleDateString('pt-PT', { weekday: 'short' }).replace('.', '');
                    dName = dName.charAt(0).toUpperCase() + dName.slice(1);
                    const max = Math.round(data.daily.temperature_2m_max[i]);
                    const min = Math.round(data.daily.temperature_2m_min[i]);
                    const wInfo = getWeatherInfo(data.daily.weather_code[i], 1);

                    dCont.innerHTML += `
                        <div class="forecast-unit">
                            <span class="f-time" style="font-weight: 500;">${dName}</span>
                            <i class="fa-solid ${wInfo.icon} f-icon"></i>
                            <div><span class="f-temp">${max}°</span> <span class="f-temp min-temp">/${min}°</span></div>
                        </div>`;
                }
            } catch(e) { console.error("Erro meteo", e); }
        }
        
        updateWeather();
        setInterval(updateWeather, 300000);
    </script>
</body>
</html>